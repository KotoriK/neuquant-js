!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):i((t||self).neuquantJs={})}(this,function(t){"use strict";var i=3*Math.max(499,491,487,503),s={ncycles:100,netsize:256,samplefac:10},a=/*#__PURE__*/function(){function t(t,i){if(function(t){for(var i=1,s=arguments.length;i<s;i++){var a=arguments[i];if(null!=a)for(var h in a)Object.prototype.hasOwnProperty.call(a,h)&&(t[h]=a[h])}}(this,s,{pixels:t},i),this.netsize<4||this.netsize>256)throw new Error("Color count must be between 4 and 256");if(this.samplefac<1||this.samplefac>30)throw new Error("Sampling factor must be between 1 and 30");this.maxnetpos=this.netsize-1,this.netbiasshift=4,this.intbiasshift=16,this.intbias=1<<this.intbiasshift,this.gammashift=10,this.gamma=1<<this.gammashift,this.betashift=10,this.beta=this.intbias>>this.betashift,this.betagamma=this.beta*this.gamma,this.initrad=this.netsize>>3,this.radiusbiasshift=6,this.radiusbias=1<<this.radiusbiasshift,this.initradius=this.initrad*this.radiusbias,this.radiusdec=30,this.alphabiasshift=10,this.initalpha=1<<this.alphabiasshift,this.radbiasshift=8,this.radbias=1<<this.radbiasshift,this.alpharadbshift=this.alphabiasshift+this.radbiasshift,this.alpharadbias=1<<this.alpharadbshift,this.network=[],this.netindex=new Uint32Array(256),this.bias=new Uint32Array(this.netsize),this.freq=new Uint32Array(this.netsize),this.radpower=new Uint32Array(this.netsize>>3);for(var a=0,h=this.netsize;a<h;a++){var e=(a<<this.netbiasshift+8)/this.netsize;this.network[a]=new Float64Array([e,e,e,0]),this.freq[a]=this.intbias/this.netsize,this.bias[a]=0}}var a=t.prototype;return a.unbiasnet=function(){for(var t=0,i=this.netsize;t<i;t++)this.network[t][0]>>=this.netbiasshift,this.network[t][1]>>=this.netbiasshift,this.network[t][2]>>=this.netbiasshift,this.network[t][3]=t},a.altersingle=function(t,i,s,a,h){this.network[i][0]-=t*(this.network[i][0]-s)/this.initalpha,this.network[i][1]-=t*(this.network[i][1]-a)/this.initalpha,this.network[i][2]-=t*(this.network[i][2]-h)/this.initalpha},a.alterneigh=function(t,i,s,a,h){for(var e=Math.abs(i-t),n=Math.min(i+t,this.netsize),r=i+1,f=i-1,o=1;r<n||f>e;){var b=this.radpower[o++];if(r<n){var l=this.network[r++];l[0]-=b*(l[0]-s)/this.alpharadbias,l[1]-=b*(l[1]-a)/this.alpharadbias,l[2]-=b*(l[2]-h)/this.alpharadbias}if(f>e){var d=this.network[f--];d[0]-=b*(d[0]-s)/this.alpharadbias,d[1]-=b*(d[1]-a)/this.alpharadbias,d[2]-=b*(d[2]-h)/this.alpharadbias}}},a.contest=function(t,i,s){for(var a=~(1<<31),h=a,e=-1,n=e,r=0,f=this.netsize;r<f;r++){var o=this.network[r],b=Math.abs(o[0]-t)+Math.abs(o[1]-i)+Math.abs(o[2]-s);b<a&&(a=b,e=r);var l=b-(this.bias[r]>>this.intbiasshift-this.netbiasshift);l<h&&(h=l,n=r);var d=this.freq[r]>>this.betashift;this.freq[r]-=d,this.bias[r]+=d<<this.gammashift}return this.freq[e]+=this.beta,this.bias[e]-=this.betagamma,n},a.inxbuild=function(){for(var t=0,i=0,s=0,a=this.netsize;s<a;s++){for(var h=this.network[s],e=null,n=s,r=h[1],f=s+1;f<a;f++)(e=this.network[f])[1]<r&&(n=f,r=e[1]);if(e=this.network[n],s!==n){var o=[e[0],h[0]];h[0]=o[0],e[0]=o[1];var b=[e[1],h[1]];h[1]=b[0],e[1]=b[1];var l=[e[2],h[2]];h[2]=l[0],e[2]=l[1];var d=[e[3],h[3]];h[3]=d[0],e[3]=d[1]}if(r!==t){this.netindex[t]=i+s>>1;for(var u=t+1;u<r;u++)this.netindex[u]=s;t=r,i=s}}this.netindex[t]=i+this.maxnetpos>>1;for(var p=t+1;p<256;p++)this.netindex[p]=this.maxnetpos},a.learn=function(){var t,s=this.pixels.length,a=30+(this.samplefac-1)/3,h=s/(3*this.samplefac),e=h/this.ncycles|0,n=this.initalpha,r=this.initradius,f=r>>this.radiusbiasshift;f<=1&&(f=0);for(var o=0;o<f;o++)this.radpower[o]=n*((f*f-o*o)*this.radbias/(f*f));s<i?(this.samplefac=1,t=3):t=s%499!=0?1497:s%491!=0?1473:s%487!=0?1461:1509;for(var b=0,l=0;l<h;){var d=(255&this.pixels[b])<<this.netbiasshift,u=(255&this.pixels[b+1])<<this.netbiasshift,p=(255&this.pixels[b+2])<<this.netbiasshift,w=this.contest(d,u,p);if(this.altersingle(n,w,d,u,p),0!==f&&this.alterneigh(f,w,d,u,p),(b+=t)>=s&&(b-=s),0===e&&(e=1),++l%e==0){n-=n/a,(f=(r-=r/this.radiusdec)>>this.radiusbiasshift)<=1&&(f=0);for(var c=0;c<f;c++)this.radpower[c]=n*((f*f-c*c)*this.radbias/(f*f))}}},a.buildColorMap=function(){this.learn(),this.unbiasnet(),this.inxbuild()},a.getColorMap=function(){for(var t=new Buffer(3*this.netsize),i=new Buffer(this.netsize),s=0,a=this.netsize;s<a;s++)i[this.network[s][3]]=s;for(var h=0,e=0,n=0,r=this.netsize;h<r;h++)t[e++]=255&this.network[n=i[h]][0],t[e++]=255&this.network[n][1],t[e++]=255&this.network[n][2];return t},t}();function h(t,i,s,a){for(var h=0,e=16777216,n=0,r=t.length;n<r;){var f=i-t[n++],o=s-t[n++],b=a-t[n],l=f*f+o*o+b*b;l<e&&(e=l,h=n/3|0),n++}return h}function e(t,i){var s=new a(t,i);return s.buildColorMap(),s.getColorMap()}function n(t,i){for(var s=new Buffer(t.length/3),a={},e=0,n=0,r=t.length;e<r;){var f=t[e++],o=t[e++],b=t[e++],l=f<<16|o<<8|b;s[n++]=l in a?a[l]:a[l]=h(i,f,o,b)}return s}t.indexed=n,t.palette=e,t.quantize=function(t,i){var s=e(t,i);return{palette:s,indexed:n(t,s)}}});
//# sourceMappingURL=index.umd.js.map
