var i=3*Math.max(499,491,487,503),t={ncycles:100,netsize:256,samplefac:10},s=/*#__PURE__*/function(){function s(i,s){if(function(i){for(var t=1,s=arguments.length;t<s;t++){var a=arguments[t];if(null!=a)for(var h in a)Object.prototype.hasOwnProperty.call(a,h)&&(i[h]=a[h])}}(this,t,{pixels:i},s),this.netsize<4||this.netsize>256)throw new Error("Color count must be between 4 and 256");if(this.samplefac<1||this.samplefac>30)throw new Error("Sampling factor must be between 1 and 30");this.maxnetpos=this.netsize-1,this.netbiasshift=4,this.intbiasshift=16,this.intbias=1<<this.intbiasshift,this.gammashift=10,this.gamma=1<<this.gammashift,this.betashift=10,this.beta=this.intbias>>this.betashift,this.betagamma=this.beta*this.gamma,this.initrad=this.netsize>>3,this.radiusbiasshift=6,this.radiusbias=1<<this.radiusbiasshift,this.initradius=this.initrad*this.radiusbias,this.radiusdec=30,this.alphabiasshift=10,this.initalpha=1<<this.alphabiasshift,this.radbiasshift=8,this.radbias=1<<this.radbiasshift,this.alpharadbshift=this.alphabiasshift+this.radbiasshift,this.alpharadbias=1<<this.alpharadbshift,this.network=[],this.netindex=new Uint32Array(256),this.bias=new Uint32Array(this.netsize),this.freq=new Uint32Array(this.netsize),this.radpower=new Uint32Array(this.netsize>>3);for(var a=0,h=this.netsize;a<h;a++){var e=(a<<this.netbiasshift+8)/this.netsize;this.network[a]=new Float64Array([e,e,e,0]),this.freq[a]=this.intbias/this.netsize,this.bias[a]=0}}var a=s.prototype;return a.unbiasnet=function(){for(var i=0,t=this.netsize;i<t;i++)this.network[i][0]>>=this.netbiasshift,this.network[i][1]>>=this.netbiasshift,this.network[i][2]>>=this.netbiasshift,this.network[i][3]=i},a.altersingle=function(i,t,s,a,h){this.network[t][0]-=i*(this.network[t][0]-s)/this.initalpha,this.network[t][1]-=i*(this.network[t][1]-a)/this.initalpha,this.network[t][2]-=i*(this.network[t][2]-h)/this.initalpha},a.alterneigh=function(i,t,s,a,h){for(var e=Math.abs(t-i),r=Math.min(t+i,this.netsize),n=t+1,f=t-1,o=1;n<r||f>e;){var b=this.radpower[o++];if(n<r){var l=this.network[n++];l[0]-=b*(l[0]-s)/this.alpharadbias,l[1]-=b*(l[1]-a)/this.alpharadbias,l[2]-=b*(l[2]-h)/this.alpharadbias}if(f>e){var p=this.network[f--];p[0]-=b*(p[0]-s)/this.alpharadbias,p[1]-=b*(p[1]-a)/this.alpharadbias,p[2]-=b*(p[2]-h)/this.alpharadbias}}},a.contest=function(i,t,s){for(var a=~(1<<31),h=a,e=-1,r=e,n=0,f=this.netsize;n<f;n++){var o=this.network[n],b=Math.abs(o[0]-i)+Math.abs(o[1]-t)+Math.abs(o[2]-s);b<a&&(a=b,e=n);var l=b-(this.bias[n]>>this.intbiasshift-this.netbiasshift);l<h&&(h=l,r=n);var p=this.freq[n]>>this.betashift;this.freq[n]-=p,this.bias[n]+=p<<this.gammashift}return this.freq[e]+=this.beta,this.bias[e]-=this.betagamma,r},a.inxbuild=function(){for(var i=0,t=0,s=0,a=this.netsize;s<a;s++){for(var h=this.network[s],e=null,r=s,n=h[1],f=s+1;f<a;f++)(e=this.network[f])[1]<n&&(r=f,n=e[1]);if(e=this.network[r],s!==r){var o=[e[0],h[0]];h[0]=o[0],e[0]=o[1];var b=[e[1],h[1]];h[1]=b[0],e[1]=b[1];var l=[e[2],h[2]];h[2]=l[0],e[2]=l[1];var p=[e[3],h[3]];h[3]=p[0],e[3]=p[1]}if(n!==i){this.netindex[i]=t+s>>1;for(var d=i+1;d<n;d++)this.netindex[d]=s;i=n,t=s}}this.netindex[i]=t+this.maxnetpos>>1;for(var u=i+1;u<256;u++)this.netindex[u]=this.maxnetpos},a.learn=function(){var t,s=this.pixels.length,a=30+(this.samplefac-1)/3,h=s/(3*this.samplefac),e=h/this.ncycles|0,r=this.initalpha,n=this.initradius,f=n>>this.radiusbiasshift;f<=1&&(f=0);for(var o=0;o<f;o++)this.radpower[o]=r*((f*f-o*o)*this.radbias/(f*f));s<i?(this.samplefac=1,t=3):t=s%499!=0?1497:s%491!=0?1473:s%487!=0?1461:1509;for(var b=0,l=0;l<h;){var p=(255&this.pixels[b])<<this.netbiasshift,d=(255&this.pixels[b+1])<<this.netbiasshift,u=(255&this.pixels[b+2])<<this.netbiasshift,w=this.contest(p,d,u);if(this.altersingle(r,w,p,d,u),0!==f&&this.alterneigh(f,w,p,d,u),(b+=t)>=s&&(b-=s),0===e&&(e=1),++l%e==0){r-=r/a,(f=(n-=n/this.radiusdec)>>this.radiusbiasshift)<=1&&(f=0);for(var v=0;v<f;v++)this.radpower[v]=r*((f*f-v*v)*this.radbias/(f*f))}}},a.buildColorMap=function(){this.learn(),this.unbiasnet(),this.inxbuild()},a.getColorMap=function(){for(var i=new Buffer(3*this.netsize),t=new Buffer(this.netsize),s=0,a=this.netsize;s<a;s++)t[this.network[s][3]]=s;for(var h=0,e=0,r=0,n=this.netsize;h<n;h++)i[e++]=255&this.network[r=t[h]][0],i[e++]=255&this.network[r][1],i[e++]=255&this.network[r][2];return i},s}();function a(i,t,s,a){for(var h=0,e=16777216,r=0,n=i.length;r<n;){var f=t-i[r++],o=s-i[r++],b=a-i[r],l=f*f+o*o+b*b;l<e&&(e=l,h=r/3|0),r++}return h}function h(i,t){var a=new s(i,t);return a.buildColorMap(),a.getColorMap()}function e(i,t){for(var s=new Buffer(i.length/3),h={},e=0,r=0,n=i.length;e<n;){var f=i[e++],o=i[e++],b=i[e++],l=f<<16|o<<8|b;s[r++]=l in h?h[l]:h[l]=a(t,f,o,b)}return s}function r(i,t){var s=h(i,t);return{palette:s,indexed:e(i,s)}}export{e as indexed,h as palette,r as quantize};
//# sourceMappingURL=index.js.map
